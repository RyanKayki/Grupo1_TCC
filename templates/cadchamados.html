{% extends 'modelo.html' %}
{% block conteudo %}

  <style>
    main {
      background-color: #F7FCFC;
      font-family: 'Open Sans', sans-serif;
    }
    .card {
      border: none;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    .btn-success {
      background-color: #225656;
      border: none;
    }
    .form-select, .form-control {
      background-color: #E0E5E5;
      border: none;
    }
    .form-control::placeholder {
      color: #7D8C8C;
    }
    .file-input {
      border: none;
      position: relative;
      padding: 0.5rem;
      background-color: #E0E5E5;
      color: #7D8C8C;
    }
    .file-input::before {
      content: '\f0c6'; /* Ícone de clip */
      font-family: FontAwesome;
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.5rem;
      color: #7D8C8C;
    }
    .section-title {
      color: #225656;
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }
  </style>

  <main>
    <div class="container">
      <!-- Seção de Seleção de Setor -->
      <h2 class="section-title pt-4 pb-2">Setor</h2>

      <!-- Seletor duplo para "Por" e "Sala/Equipamento" -->
      <div class="d-flex justify-content-center mb-3">
        <!-- Select para "Por" -->
        <div class="me-3">
          <label for="porSelect" class="form-label">Por:</label>
          <select class="form-select" id="porSelect" name="por" onchange="updateSetorOptions()" style="width: 200px;">
            <option value="sala" selected>Sala</option>
            <option value="equipamento">Equipamento</option>
          </select>
        </div>

        <!-- Select para "Sala" ou "Equipamento" que vai mudar dinamicamente -->
        <div>
          <label for="setorSelect" class="form-label" id="setorLabel">Sala:</label>
          <select class="form-select" id="setorSelect" name="setor" style="width: 200px;">
            <!-- Aqui as opções serão carregadas via Django -->
            {% for sala in salas %}
              <option value="{{ sala.id }}">{{ sala.nome }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <!-- Formulário de Chamados -->
      <div class="card mx-auto" style="max-width: 600px; background-color: #fff;">
        <div class="card-body">
          <h5 class="section-title">Chamados</h5>

          <!-- Select de Problemas Comuns -->
          <div class="mb-3">
            <label for="problemasComuns" class="form-label">Problemas comuns</label>
            <select class="form-select" id="problemasComuns" name="problema_comum" onchange="checkProblemaComum()">
              <option selected>Escolha um problema...</option>
              <option value="internet">Problema de Internet</option>
              <option value="energia">Falta de Energia</option>
              <option value="equipamento">Problema com Equipamento</option>
              <option value="outros">Outros</option>
            </select>
          </div>

          <!-- Campo de descrição extra para "Outros" -->
          <div class="mb-3 d-none" id="outrosProblemaContainer">
            <input type="text" class="form-control" id="outrosProblema" name="outros_problema" placeholder="Descreva o problema...">
          </div>

          <!-- Campo de Descrição -->
          <div class="mb-3">
            <input type="text" class="form-control" id="descricaoProblema" name="descricao_problema" placeholder="Descrição...">
          </div>

          <!-- Upload de Foto -->
          <div class="mb-3">
            <input type="file" class="file-input form-control" id="fotoProblema" name="foto_problema" accept="image/*">
          </div>

          <!-- Botão Concluído -->
          <div class="text-center">
            <button type="submit" class="btn btn-success">Concluído</button>
          </div>

        </div>
      </div>

    </div>
  </main>

  <script>
    // Função que altera as opções conforme o valor selecionado em "Por"
    function updateSetorOptions() {
      var porSelect = document.getElementById('porSelect').value;
      var setorLabel = document.getElementById('setorLabel');
      var setorSelect = document.getElementById('setorSelect');
      var options = '';

      if (porSelect === 'sala') {
        setorLabel.innerText = 'Sala:';
        options = `{% for sala in salas %}<option value="{{ sala.id }}">{{ sala.nome }}</option>{% endfor %}`;
      } else {
        setorLabel.innerText = 'Equipamento:';
        options = `{% for equipamento in equipamentos %}<option value="{{ equipamento.id }}">{{ equipamento.nome }}</option>{% endfor %}`;
      }
      setorSelect.innerHTML = options;
    }

    // Função para exibir campo extra ao selecionar "Outros"
    function checkProblemaComum() {
      var problemaComum = document.getElementById('problemasComuns').value;
      var outrosContainer = document.getElementById('outrosProblemaContainer');
      if (problemaComum === 'outros') {
        outrosContainer.classList.remove('d-none');
      } else {
        outrosContainer.classList.add('d-none');
      }
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}
